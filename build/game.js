window.onload=function(){function e(){return{points:30,pps:2,system:0,planet:0,items:{solarpanel:{pps:2,prices:{unlock:1,repair:20},count:1,unlocked:!0,visible:!0},nanobots:{pps:10,prices:{unlock:1e3,repair:150},count:0,unlocked:!1,visible:!0},satellite:{pps:50,prices:{unlock:4e4,repair:2e3},count:0,unlocked:!1,visible:!1,instances:[]},rover:{pps:200,prices:{unlock:15e4,repair:7500},count:0,unlocked:!1,visible:!1,instances:[]},fusioncell:{pps:1e3,prices:{unlock:75e4,repair:35e3},count:0,unlocked:!1,visible:!1},radiatorpanel:{pps:1e4,prices:{unlock:3e6,repair:25e4},count:0,unlocked:!1,visible:!1}},upgrades:{solararray:{price:2e4,available:!1,unlocked:!1,visible:!1},satbuild:{price:1e6,available:!1,unlocked:!1,visible:!1},commsnet:{price:5e7,available:!0,unlocked:!1,visible:!0},contactearth:{price:1e8,available:!1,unlocked:!1,visible:!1}}}}function t(){c(),o()}function n(e){O.points+=O.pps*e/1e3}function i(){var e=0;for(var t in O.items)O.items.hasOwnProperty(t)&&(e+=O.items[t].pps*O.items[t].count);O.pps=e}function s(e){O.items[e].unlocked||O.points>=O.items[e].prices.unlock&&(O.points-=O.items[e].prices.unlock,O.items[e].unlocked=!0,O.points+=O.items[e].prices.repair,a(e),"nanobots"==e&&(O.upgrades.solararray.available=!0,O.upgrades.solararray.visible=!0,d("solararray",1),O.items.satellite.visible=!0,d("satellite",0)),"satellite"==e&&(O.items.rover.visible=!0,d("rover",0)),"rover"==e&&(O.items.fusioncell.visible=!0,d("fusioncell",0)),"fusioncell"==e&&(O.upgrades.satbuild.available=!0,O.upgrades.satbuild.visible=!0,d("satbuild",1),O.items.radiatorpanel.visible=!0,d("radiatorpanel",0)),"radiatorpanel"==e&&O.upgrades.commsnet.unlocked&&(O.upgrades.contactearth.available=!0,O.upgrades.contactearth.visible=!0,d("contactearth",1)),d(e,0))}function a(e){O.items[e].unlocked&&O.points>=O.items[e].prices.repair&&(O.points-=O.items[e].prices.repair,O.pps+=O.items[e].pps,O.items[e].count+=1,O.items[e].prices.repair=Math.ceil(1.125*O.items[e].prices.repair),"satellite"==e&&O.items[e].instances.push({x:P.x,y:P.y,desiredradius:E(Math.min(100,I.width/6,I.height/6)+20,Math.min(I.width/2,I.height/2)-3),radius:P.radius,angle:P.angle,colour:"#FFFFFF"}),"rover"==e&&O.items[e].instances.push({x:P.x,y:P.y,desiredradius:T.radius-2,radius:P.radius,angle:P.angle,colour:"#FFFFFF"}),d(e,0))}function l(n){O.upgrades[n].available&&!O.upgrades[n].unlocked&&O.points>=O.upgrades[n].price&&(O.points-=O.upgrades[n].price,O.upgrades[n].unlocked=!0,O.upgrades[n].visible=!1,"solararray"==n&&(O.items.solarpanel.pps=3,i(),d("solarpanel",0)),"satbuild"==n&&(O.items.satellite.prices.repair-=Math.floor(O.items.satellite.prices.repair/100*30),d("satellite",0)),"commsnet"==n&&O.items.radiatorpanel.unlocked&&(O.items.satellite.pps=200,O.items.rover.pps=800,i(),d("satellite",0),d("rover",0),O.upgrades.contactearth.available=!0,O.upgrades.contactearth.visible=!0,d("contactearth",1)),d(n,1),document.getElementById("ship-view-toggle").click(),"contactearth"==n&&(document.getElementById("mainmenu").classList.remove("active"),document.getElementById("intro").classList.remove("active"),document.getElementById("game").classList.remove("active"),document.getElementById("ending").classList.add("active"),b=!1,O=e(),t(),document.getElementById("planet-view-toggle").click()))}function r(){document.getElementById("points").innerHTML=k(O.points),document.getElementById("pps").innerHTML=O.pps+"/s"}function c(){for(var e in O.items)O.items.hasOwnProperty(e)&&d(e,0)}function o(){for(var e in O.upgrades)O.upgrades.hasOwnProperty(e)&&d(e,1)}function d(e,t){(t?O.upgrades[e].visible:O.items[e].visible)?(document.getElementById(e+"-toggle").classList.remove("hidden"),t?m(e):u(e)):document.getElementById(e+"-toggle").classList.add("hidden")}function u(e){document.getElementById(e+"-count").innerHTML=k(O.items[e].count),document.getElementById(e+"-pps").innerHTML=k(O.items[e].count*O.items[e].pps)+"/s",O.items[e].unlocked?(document.getElementById(e+"-unlock").classList.add("hidden"),document.getElementById(e+"-repair").classList.remove("hidden"),document.getElementById(e+"-repair-price").innerHTML=k(O.items[e].prices.repair)):(document.getElementById(e+"-unlock").classList.remove("hidden"),document.getElementById(e+"-repair").classList.add("hidden"),document.getElementById(e+"-unlock-price").innerHTML=k(O.items[e].prices.unlock))}function m(e){document.getElementById(e+"-unlock-price").innerHTML=k(O.upgrades[e].price)}function p(){var e=f(P,H.centre);P.x=e.x,P.y=e.y,P.angle=e.angle;for(var t=0;t<Object.keys(O.items.satellite.instances).length;t++){O.items.satellite.instances[t].radius!==O.items.satellite.instances[t].desiredradius&&(O.items.satellite.instances[t].radius<O.items.satellite.instances[t].desiredradius?(O.items.satellite.instances[t].radius+=I.width/3/5e3,O.items.satellite.instances[t].radius>=O.items.satellite.instances[t].desiredradius&&(O.items.satellite.instances[t].radius=O.items.satellite.instances[t].desiredradius)):(O.items.satellite.instances[t].radius-=I.width/3/5e3,O.items.satellite.instances[t].radius<=O.items.satellite.instances[t].desiredradius&&(O.items.satellite.instances[t].radius=O.items.satellite.instances[t].desiredradius)));var n=f(O.items.satellite.instances[t],H.centre);O.items.satellite.instances[t].x=n.x,O.items.satellite.instances[t].y=n.y,O.items.satellite.instances[t].angle=n.angle}for(var t=0;t<Object.keys(O.items.rover.instances).length;t++)if(O.items.rover.instances[t].radius!==O.items.rover.instances[t].desiredradius){O.items.rover.instances[t].radius-=I.width/3/2500,O.items.rover.instances[t].radius<=O.items.rover.instances[t].desiredradius&&(O.items.rover.instances[t].radius=O.items.rover.instances[t].desiredradius);var i=f(O.items.rover.instances[t],H.centre);O.items.rover.instances[t].x=i.x,O.items.rover.instances[t].y=i.y,O.items.rover.instances[t].angle=i.angle}}function v(){B.clearRect(0,0,I.width,I.height),h(T);for(var e=0;e<Object.keys(O.items.satellite.instances).length;e++)g(O.items.satellite.instances[e],0,0);for(var e=0;e<Object.keys(O.items.rover.instances).length;e++)g(O.items.rover.instances[e],0,1);g(P,1,0),r()}function g(e,t,n){if(n&&e.radius<e.desiredradius+10);else{B.beginPath(),B.arc(H.centre.x,H.centre.y,e.radius+1,e.angle,e.angle+2,!0);var i=B.createRadialGradient(e.x,e.y,0,e.x,e.y,e.radius);i.addColorStop("0","#2f3e4b"),i.addColorStop("0.9","#27343f"),i.addColorStop("1","rgba(32, 42, 51, 0)"),B.strokeStyle=i,B.lineWidth=1,B.stroke()}B.save(),B.translate(e.x,e.y),B.rotate(Math.atan2(e.y-H.centre.y,e.x-H.centre.x)),t?(O.upgrades.solararray.unlocked&&(B.fillStyle="rgba(255, 255, 255, 0.5)",B.fillRect(-4,4,10,1)),B.fillStyle=e.colour,B.fillRect(0,0,2,8),B.fillRect(-1,0,4,3)):(B.fillStyle=e.colour,B.fillRect(0,0,2,2)),B.restore()}function h(e){B.save(),B.beginPath(),B.arc(H.centre.x,H.centre.y,e.glow.radius,0,2*Math.PI);var t=B.createRadialGradient(H.centre.x,H.centre.y,e.glow.from,H.centre.x,H.centre.y,e.glow.to);t.addColorStop("0",e.glow.start),t.addColorStop("1",e.glow.finish),B.fillStyle=t,B.fill(),B.restore(),B.beginPath(),B.arc(H.centre.x,H.centre.y,e.radius,0,2*Math.PI),B.fillStyle=e.colour,B.fill()}function f(e,t){return angle=(e.angle+1/(3*e.radius))%360,{x:t.x+Math.cos(angle)*e.radius,y:t.y+Math.sin(angle)*e.radius,angle:angle}}function y(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function E(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function k(e){return Math.round(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var b=!1,L=document.getElementById("planet-canvas-container"),I=document.getElementById("planet-canvas"),B=I.getContext("2d");B.canvas.width=Math.min(L.clientWidth,L.clientHeight),B.canvas.height=Math.min(L.clientWidth,L.clientHeight);var w=document.querySelectorAll(".view-toggles p span"),M=document.getElementById("items-menu"),x=document.querySelectorAll(".item-toggles p"),D=document.querySelectorAll(".views .view"),F=document.querySelectorAll(".items .item"),S=document.querySelectorAll(".ship-view-back"),H={now:0,last:y(),dt:0,fps:60,view:"planet",centre:{x:I.width/2,y:I.height/2}},P={x:Math.min(I.width-I.width/6,I.height-I.height/6),y:Math.min(I.width-I.width/6,I.height-I.height/6),radius:Math.min(I.width/3,I.height/3),angle:1,colour:"#FFFFFF"},T={radius:Math.min(100,I.width/6,I.height/6),colour:"#902EFF",glow:{radius:Math.min(110,I.width/6+10,I.height/6+10),from:Math.min(90,I.width/6-10,I.height/6-10),to:Math.min(104,I.width/6+4,I.height/6+4),start:"rgba(144, 46, 255, 0.25)",finish:"rgba(144, 46, 255, 0.25)"}},O=e();t(),setInterval(function(){b&&(H.now=y(),H.dt=H.now-H.last,n(H.dt),p(),v(),H.last=H.now)},1e3/H.fps),document.getElementById("mmtointro").addEventListener("click",function(e){e.preventDefault(),document.getElementById("mainmenu").classList.remove("active"),document.getElementById("intro").classList.add("active"),document.getElementById("game").classList.remove("active"),document.getElementById("ending").classList.remove("active"),b=!1}),document.getElementById("introtogame").addEventListener("click",function(e){e.preventDefault(),document.getElementById("mainmenu").classList.remove("active"),document.getElementById("intro").classList.remove("active"),document.getElementById("game").classList.add("active"),document.getElementById("ending").classList.remove("active"),H.last=y(),b=!0}),document.getElementById("endingtointro").addEventListener("click",function(e){e.preventDefault(),document.getElementById("mainmenu").classList.remove("active"),document.getElementById("intro").classList.add("active"),document.getElementById("game").classList.remove("active"),document.getElementById("ending").classList.remove("active"),b=!1});for(var R=0;R<w.length;R++)w[R].addEventListener("click",function(e){for(var t=0;t<w.length;t++)w[t].classList.remove("active");for(var t=0;t<D.length;t++)D[t].classList.remove("active");for(var t=0;t<F.length;t++)F[t].classList.remove("active");M.classList.remove("hidden");var n=this.id,i=this.id.split("-")[0]+"-"+this.id.split("-")[1];document.getElementById(n).classList.add("active"),document.getElementById(i).classList.add("active")});for(var R=0;R<x.length;R++)x[R].addEventListener("click",function(e){var t=this.id.split("-")[0];document.getElementById(t).classList.add("active"),M.classList.add("hidden")});for(var R=0;R<S.length;R++)S[R].addEventListener("click",function(e){for(var t=0;t<F.length;t++)F[t].classList.remove("active");M.classList.remove("hidden")});document.getElementById("solarpanel-unlock-button").addEventListener("click",function(e){e.preventDefault(),s("solarpanel")}),document.getElementById("solarpanel-repair-button").addEventListener("click",function(e){e.preventDefault(),a("solarpanel")}),document.getElementById("nanobots-unlock-button").addEventListener("click",function(e){e.preventDefault(),s("nanobots")}),document.getElementById("nanobots-repair-button").addEventListener("click",function(e){e.preventDefault(),a("nanobots")}),document.getElementById("satellite-unlock-button").addEventListener("click",function(e){e.preventDefault(),s("satellite")}),document.getElementById("satellite-repair-button").addEventListener("click",function(e){e.preventDefault(),a("satellite")}),document.getElementById("rover-unlock-button").addEventListener("click",function(e){e.preventDefault(),s("rover")}),document.getElementById("rover-repair-button").addEventListener("click",function(e){e.preventDefault(),a("rover")}),document.getElementById("fusioncell-unlock-button").addEventListener("click",function(e){e.preventDefault(),s("fusioncell")}),document.getElementById("fusioncell-repair-button").addEventListener("click",function(e){e.preventDefault(),a("fusioncell")}),document.getElementById("radiatorpanel-unlock-button").addEventListener("click",function(e){e.preventDefault(),s("radiatorpanel")}),document.getElementById("radiatorpanel-repair-button").addEventListener("click",function(e){e.preventDefault(),a("radiatorpanel")}),document.getElementById("solararray-unlock-button").addEventListener("click",function(e){e.preventDefault(),l("solararray")}),document.getElementById("satbuild-unlock-button").addEventListener("click",function(e){e.preventDefault(),l("satbuild")}),document.getElementById("commsnet-unlock-button").addEventListener("click",function(e){e.preventDefault(),l("commsnet")}),document.getElementById("contactearth-unlock-button").addEventListener("click",function(e){e.preventDefault(),l("contactearth")})};